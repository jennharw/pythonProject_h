SELECT
 sch110_sch_cd,
 sch110_sch_nm,
 in_out,
 KEDI장학금구분,
 학생소속대학명,
-- 학과,
 SUM(SCH214_TUITION_FEE),
 SUM(SCH214_ADMISSION_FEE),
 SUM(SCH214_ETC_FEE)
FROM (SELECT
F_NCOM_DEPT_NM(A.COM020_ADPT_CD) 학생소속대학명,
 f_ncom_code_nm('REC050', REC511_ENT_DIV) ,
REC511_STD_ID,
REC511_STD_DIV,
-- rec511_std_div in ('2','4')
REC511_SEX,
F_NCOM_CODE_NM('REC050', REC511_ENT_DIV),
F_NCOM_CODE_NM('REC051', REC511_REC_STS),
F_NCOM_DEPT_NM(REC511_COL_GRAD),
F_NCOM_DEPT_NM(REC511_DEPT_CD) 학과,
F_NCOM_DEPT_NM(REC511_MAJOR_CD),
F_NPER_EMP_NM(REC511_PROF_ID),
F_NCOM_CODE_NM('COM013', REC511_DEG_DIV),
SCH214_YEAR,
SCH214_TERM,
SCH214_STD_ID,
SCH214_GRAD_CD,
SCH214_DEPT_CD,
SCH214_SCHOOL_TERM,
SCH214_TUITION_FEE,
SCH214_ADMISSION_FEE,
SCH214_ETC_FEE,
SCH214_RECEIVE_YN,
SCH214_GUBUN,
SCH110_SCH_CD,
F_NCOM_DEPT_NM(SCH110_DPT_CD),
F_NCOM_CODE_NM('SCH001', SCH110_SCH_DIV) AS IN_OUT,
SCH110_SPONSOR_CD,
SCH130_SPONSOR_NM,
SCH110_SCH_NM,
SCH110_TUITION_PCT,
SCH110_ADMISSION_PCT,
SCH110_REG_PCT,
SCH110_ETC_FEE,
SCH110_USE_YN,
SCH110_ALIAS,
--SCH110_RSN_DIV,
F_NCOM_CODE_NM('SCH004',SCH110_RSN_DIV) AS 지급사유
,SCH110_GUBUN_CD, --1사전 2 사후
SCH110_DOUBLE_YN,
--SCH110_ORG_DIV,
F_NCOM_CODE_NM('SCH011',SCH110_ORG_DIV) AS 장학금출처,
SCH110_REG_DIV,--장학금재원구분(1:등록금2:일반)
SCH110_LOAN_DIV,--장학금융자구분(1:장학금2:융자)
SCH110_ASSIST_YN,--조교장학금여부(Y/N)
--SCH110_OUT_RSN_DIV,
F_NCOM_CODE_NM('SCH027', SCH110_GIVING_DIV) AS 지급형태구분,
F_NCOM_CODE_NM('SCH037', SCH110_KEDI_SCH_DIV) AS KEDI장학금구분
,F_NCOM_CODE_NM('SCH032', SCH110_NATION_SCH_CD) AS 국가장학금코드
,f_ncom_code_nm('SCH017', sch110_out_rsn_div) AS 교외장학금지급사유,
F_NCOM_CODE_NM('NPER004',SCH110_ASSIST_DIV) 조교구분
,F_NCOM_CODE_NM('SCH003', SCH110_GRANT_DIV),
SCH110_KEDI_INSCH --y 내부장학금

FROM KUPID.REC511VW, SCH214TL, SCH110TL, KUPID.SCH130TL, com020tl a
WHERE 1=1
AND REC511_STD_ID = SCH214_STD_ID
AND SCH214_SCH_CD = SCH110_SCH_CD
AND SCH214_DEPT_CD = a.COM020_DPT_CD
AND a.COM020_CAMPUS = 1
AND rec511_std_div in ('2','4')
AND REC511_COL_GRAD = '0309'
and a.com020_adpt_cd not in ('0231', '0226')
--AND REC511_DEPT_CD IN ( '0311', '0333')
AND sch214_year > '2017'
and (nvl2(SCH110_CRE_DT,to_char(SCH110_CRE_DT,'yyyy'),'1900') > '2017' or  SCH110_USE_YN ='Y')
--USE_YN , RECEIVE _YN
and sch110_use_yn = 'Y'
AND SCH214_RECEIVE_YN = 'Y'
AND SCH110_SPONSOR_CD = sch130_sponsor_cd (+)

UNION

SELECT
F_NCOM_DEPT_NM(A.COM020_ADPT_CD) 학생소속대학명,
 f_ncom_code_nm('REC050', REC511_ENT_DIV) ,

REC511_STD_ID,
REC511_STD_DIV,
-- rec511_std_div in ('2','4')
REC511_SEX,
F_NCOM_CODE_NM('REC050', REC511_ENT_DIV),
F_NCOM_CODE_NM('REC051', REC511_REC_STS),
F_NCOM_DEPT_NM(REC511_COL_GRAD),
F_NCOM_DEPT_NM(REC511_DEPT_CD),
F_NCOM_DEPT_NM(REC511_MAJOR_CD),
F_NPER_EMP_NM(REC511_PROF_ID),
F_NCOM_CODE_NM('COM013', REC511_DEG_DIV),
SCH212_YEAR,
SCH212_TERM,
SCH212_STD_ID,
SCH212_GRAD_CD,
SCH212_DEPT_CD,
SCH212_SCHOOL_TERM,
SCH212_TUITION_FEE,
SCH212_ADMISSION_FEE,
SCH212_ETC_FEE,
SCH212_RECEIVE_YN,
SCH212_GUBUN,
SCH110_SCH_CD,
F_NCOM_DEPT_NM(SCH110_DPT_CD),
F_NCOM_CODE_NM('SCH001', SCH110_SCH_DIV),
SCH110_SPONSOR_CD,
SCH130_SPONSOR_NM,
SCH110_SCH_NM,
SCH110_TUITION_PCT,
SCH110_ADMISSION_PCT,
SCH110_REG_PCT,
SCH110_ETC_FEE,
SCH110_USE_YN,
SCH110_ALIAS,
--SCH110_RSN_DIV,
F_NCOM_CODE_NM('SCH004',SCH110_RSN_DIV) AS 지급사유
,SCH110_GUBUN_CD, --1사전 2 사후
SCH110_DOUBLE_YN,
--SCH110_ORG_DIV,
F_NCOM_CODE_NM('SCH011',SCH110_ORG_DIV) AS 장학금출처,
SCH110_REG_DIV,--장학금재원구분(1:등록금2:일반)
SCH110_LOAN_DIV,--장학금융자구분(1:장학금2:융자)
SCH110_ASSIST_YN,--조교장학금여부(Y/N)
--SCH110_OUT_RSN_DIV,
F_NCOM_CODE_NM('SCH027', SCH110_GIVING_DIV) AS 지급형태구분,
F_NCOM_CODE_NM('SCH037', SCH110_KEDI_SCH_DIV) AS KEDI장학금구분
,F_NCOM_CODE_NM('SCH032', SCH110_NATION_SCH_CD) AS 국가장학금코드
,f_ncom_code_nm('SCH017', sch110_out_rsn_div) AS 교외장학금지급사유,
F_NCOM_CODE_NM('NPER004',SCH110_ASSIST_DIV) 조교구분
,F_NCOM_CODE_NM('SCH003', SCH110_GRANT_DIV),
SCH110_KEDI_INSCH --y 내부장학금
FROM KUPID.REC511VW, SCH212TL, SCH110TL, KUPID.SCH130TL, com020tl a
WHERE 1=1
AND REC511_STD_ID = SCH212_STD_ID
AND SCH212_SCH_CD = SCH110_SCH_CD
AND SCH212_DEPT_CD = a.COM020_DPT_CD
AND a.COM020_CAMPUS = 1
AND rec511_std_div in ('2','4')
AND REC511_COL_GRAD = '0309'
and a.com020_adpt_cd not in ('0231', '0226')
AND sch212_year > '2017'
and (nvl2(SCH110_CRE_DT,to_char(SCH110_CRE_DT,'yyyy'),'1900') > '2017' or  SCH110_USE_YN ='Y')
and sch110_use_yn = 'Y'
AND SCH212_RECEIVE_YN = 'Y'
AND SCH110_SPONSOR_CD = sch130_sponsor_cd (+) ) A GROUP BY sch110_sch_cd,
 sch110_sch_nm,
 in_out,
 KEDI장학금구분,
 학생소속대학명
